name: "Create Docker images for microservices and push them to Docker Hub"

on:
  workflow_dispatch:

jobs:
  docker-build-push:
    name: Build and Push Docker Images
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3
    - name: Docker Login
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
    - name: Build Docker and push Image
      run: |
        # cat .github/MICROSERVICES_LIST/microservices_list.txt
        # IFS=$'\n' read -d '' -ra microsvc < .github/MICROSERVICES_LIST/microservices_list.txt
        readarray -t microsvc < .github/MICROSERVICES_LIST/microservices_list.txt
        echo $microsvc
        # for work_dir in "${microsvc[@]}"; do
        #   image_name=$(echo "$work_dir" | cut -d'/' -f1)
        #   echo $work_dir
        #   echo $image_name
          # docker build -t $DOCKER_USERNAME/$image_name:$GITHUB_SHA -f ./build/maven/Dockerfile --build-arg WORK_DIR=$work_dir .
          # docker push $DOCKER_USERNAME/$image_name:$GITHUB_SHA
        # done
      env:
        DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
        GITHUB_SHA: ${{ github.sha }}
